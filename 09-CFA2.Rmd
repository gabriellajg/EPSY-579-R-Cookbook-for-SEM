# Week7_2: Lavaan Lab 6 Two-factor CFA Model


## Data Prep

We will continue to use cfaInClassData.csv in this lab. 

Let's read this dataset in: 

```{r}
cfaData<- read.csv("cfaInclassData.csv", header = T)
```

Load up the lavaan library and run some CFA's!

```{r}
library(lavaan)
```

<!------------------------------>
## Part 1: Two-Factor CFA, Fixed Loading
<!------------------------------>

### Fixed Loading, AKA Marker Variable method. 

Let's write up the model syntax for the measurement model with two factors:

```{r}
fixedIndTwoFacSyntax <- "
	#Factor Specification	
	posAffect    =~    glad + happy + cheerful 
	satisfaction =~ satisfied + content + comfortable
"
```

Here we named the fitted object 'fixedIndTwoFacRun' to see our output: 

```{r}
fixedIndTwoFacRun = lavaan::sem(model = fixedIndTwoFacSyntax, data = cfaData, fixed.x=FALSE)
```

Get a summary using summary() function, add standardized=T to request standardized parameter estimates: 

```{r}
summary(fixedIndTwoFacRun, standardized=T)
```

```{r, eval=FALSE}
df = 8 (why?)

Latent Variables:
                     Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
  posAffect =~                                        
     glad              1.000                               0.694    0.706
     happy             1.067    0.055   19.294    0.000    0.740    0.758
     cheerful          1.112    0.057   19.458    0.000    0.772    0.785
   satisfaction =~                                                       
     satisfied         1.000                               0.773    0.767
     content           1.068    0.052   20.525    0.000    0.826    0.762
     comfortable       0.918    0.045   20.336    0.000    0.709    0.746
```

What does this mean?

+ 1 unit change in posAffect (factor) produces:
  * 1-unit change in "glad" (marker indicator)
  * 1.067-unit change in "happy" (1.067 times greater than the effect on "glad")
  * 1.112-unit change in "cheerful" (1.112 times greater than the effect on "glad")

+ 1 unit change in satisfaction (factor) produces:
  * 1-unit change in "satisfied" (marker indicator)
  * 1.068-unit change in "content" (1.068 times greater than the effect on "satisfied")
  * 0.918-unit change in "comfortable" (0.918 times greater than the effect on "satisfied")

```{r, eval=FALSE}
Covariances:
                  Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
 posAffect ~~                                                          
   satisfaction      0.262    0.025   10.284    0.000    0.488    0.488
```

+ covariance between posAffect and satisfaction is 0.262
+ standardized covariance (correlation) between posAffect and satisfaction is 0.488

```{r, eval=FALSE}
Variances:
                    Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
    .glad              0.484    0.029   16.647    0.000    0.484    0.501
    .happy             0.405    0.028   14.389    0.000    0.405    0.425
    .cheerful          0.371    0.029   13.004    0.000    0.371    0.384
    .satisfied         0.419    0.029   14.326    0.000    0.419    0.412
    .content           0.491    0.034   14.542    0.000    0.491    0.419
    .comfortable       0.400    0.026   15.315    0.000    0.400    0.443
```

+ The leftover unique factor variances remain substantial
+ Meaning that none of the indicators is a perfect measure of posAffect or satisfaction
+ but they all contribute significantly to the measurement of latent variables (the standardized loadings above larger than 0.6)

Followed by two factor variances:
```{r, eval=FALSE}
                    Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
     posAffect         0.482    0.042   11.439    0.000    1.000    1.000
     satisfaction      0.597    0.047   12.686    0.000    1.000    1.000
```

which were freely estimated using Fixed Loading scaling method. 




<!------------------------------>
## Part 2: Two-Factor CFA, Fixed Factor Variance
<!------------------------------>

### Fixed Factor Method

Keep using the same syntax but assign a new name: 

```{r}
fixedFacTwoFacSyntax <- "
	#Factor Specification	
	posAffect =~ glad + happy + cheerful 
	satisfaction =~ satisfied + content + comfortable
"
```

To fix the variance of the latent variable to 1, add std.lv=T to sem() function: 

```{r}
fixedFacTwoFacRun = sem(model = fixedFacTwoFacSyntax, 
                        data = cfaData, 
                        fixed.x=FALSE, 
                        std.lv=T)
```

Get a summary using summary() function, add standardized=T to request standardized parameter estimates 

```{r}
summary(fixedFacTwoFacRun, standardized=T)
```


```{r, eval=FALSE}
 df = 8  # same!

Latent Variables:
                   Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
  posAffect =~                                                          
    glad              0.694    0.030   22.878    0.000    0.694    0.706
    happy             0.740    0.030   24.806    0.000    0.740    0.758
    cheerful          0.772    0.030   25.798    0.000    0.772    0.785
  satisfaction =~                                                       
    satisfied         0.773    0.030   25.373    0.000    0.773    0.767
    content           0.826    0.033   25.207    0.000    0.826    0.762
    comfortable       0.709    0.029   24.584    0.000    0.709    0.746
```

+ 1-SD change in the factor (posAffect) causes:
  * 0.694-unit change in glad (on its raw scale)
  * 0.740-unit change in happy (on its raw scale)
  * 0.772-unit change in cheerful (on its raw scale)

+ 1-SD change in the factor (satisfaction) causes:
  * 0.773-unit change in satisfied (on its raw scale)
  * 0.826-unit change in content (on its raw scale)
  * 0.709-unit change in comfortable (on its raw scale)

```{r, eval=FALSE}
 Covariances:
                    Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
   posAffect ~~                                                          
     satisfaction      0.262    0.025   10.284    0.000    0.488    0.488

Variances:
                    Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
    .glad              0.484    0.029   16.647    0.000    0.484    0.501
    .happy             0.405    0.028   14.389    0.000    0.405    0.425
    .cheerful          0.371    0.029   13.004    0.000    0.371    0.384
    .satisfied         0.419    0.029   14.326    0.000    0.419    0.412
    .content           0.491    0.034   14.542    0.000    0.491    0.419
    .comfortable       0.400    0.026   15.315    0.000    0.400    0.443
```

remain unchanged. 

Followed by two factor variances.

```{r, eval=FALSE}
                    Estimate  Std.Err  z-value  P(>|z|)   Std.lv  Std.all
    posAffect         1.000                               1.000    1.000
    satisfaction      1.000                               1.000    1.000
```

